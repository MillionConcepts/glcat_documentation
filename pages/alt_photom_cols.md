# Extended photometry columns

## Hotspots and Coldspots: Detector Artifacts 

Two artifacts that consistently appears in GALEX images regardless of observation type or duration are "hotspots" and "coldspots". Hotspots have very high count rates and generally occur in the same locations on the detector in most eclipses. Coldspots are similar to hotspots visually, but have very low count rates (~0 cps) even over long eclipses. Both coldspots and hotspots are important to identify for accurate photometric measurements, but hotspots have the added risk of possibly being identified as stars. 

The GALEX mission team drew masks to cover common hotspots on the NUV and FUV detectors. These masks (`NUV_mask.fits` and `FUV_mask.fits` in the `cal_data` folder of gPhoton2) are still used in gPhoton2 to mask reoccuring, bright hotspots on both detectors. The mission mask is applied to the photons during gPhoton2 processing, and the hotspot flag generated by that mask is accessible in the [Flag Map as Flag 1](../Image File Formats.md## Flag Maps). However, some hotspots are transient and therefore not covered by the mission-generated hotspot mask. These un-masked hotspots could be mistakenly identified as stars during source-finding and require an additional quality metric to identify them. 

### A Novel Metric for Identifying Hotspots (SIGDISP)

Detector artifacts and stars have one very useful difference: their shape in sky-projected images and detector-coordinate images. Because the telescope spiraled around the target FOV in a dither pattern, photons from the sky were collected on the detector in a pattern matching the telescope motion. Meanwhile, hotspots had a constant location on the detector during an observation. When the observation is then projected to the sky, the opposite pattern appears and hotspot tracks are shaped like the dither pattern while stars are condensed to points. 

```{image} figures/dosevsprojimg.png
:alt: hotspot_ex
:width: 700px
:align: center
```
*Figure: Example of hotspots and stars in a sky-projected count map (left) versus a detector-space dose map (right). S indicates "star" and H indicates "hotspot".*

We can visualize what this pattern would look like at the photon level. In the example below, photons from stars appear tightly clustered in sky-projected (RA/DEC) space, whereas photons from a hotspot trace a spiral in that same space. In detector space, the pattern is reversed.

```{image} figures/skyvsdose_drawing.png
:alt: swirl_drawing
:width: 400px
:align: center
```
*Figure: Illustration of the differences in star and hotspot photon patterns.*

To capture the difference between on-detector and sky-projected patterns, gPhoton2 calculates a metric we call "dispersion" for the photons in each bin (pixel) of the sky-projected backplanes. Two images are generated: the standard deviation of binned photon's detector row values and  the standard deviation of binned photon's detector column values. The "dispersion" metric is the sum of these two images. 

` dispersion = std(photon detector row values in sky-projected space) + std(photon detector column values in sky-projected space) `

Because hotspots are highly localized in detector space, we expect them to have lower dispersion values. Conversely, stars should have higher dispersion values, albeit constrained by the dither pattern of the eclipse.

```{image} figures/dispersion.png
:alt: dispersion
:width: 450px
:align: center
```
*Figure: The same set of hotspots as before on a "dispersion" image. Note the small stars visible in H2 (small bright points). The smaller hotspot (H1) is very faint.*

The dispersion image is not written as an output to gPhoton2. Instead, aperture photometry is run on the dispersion image. The results are normalized to the size of the aperture (`aperture sum / area of aperture`) and written to the column `stdcolrow_aperture_sum` in the photometry tables, or `BAND_SIGDISP_APER[ix]` in the band catalog files. Dispersion values range between eclipses based on the dither pattern, but as a rule very low values are likely hotspots or other detector-originating artifacts. Smaller aperture sizes are more useful for identifying hotspots and stars as there is less background contamination. 

### Other Applications of Dispersion 

Beyond the scope of the gPhoton2, count rate and dispersion can be useful for identifying all different parts of the backplanes. In the below example, dispersion and count are plotted against each other and matched to locations in a dose map. Note that dispersion values where two stars overlap are lower than those of stand-alone bright stars. The background has a wide range of dispersion values due to the low number of photons in each bin. 

```{image} figures/disp_map.png
:alt: dispersion
:width: 800px
:align: center
```
*Figure: Probably going to make a better version of this figure....*

## Pulse Height (Q) Photometry

Pulse height is an innate detector property of each photon in the photonlist. In MCP detectors, pulse height distribution increases as gain decreases, while gain decreases both at higher count rates (affecting bright sources) and towards the edge of the detector. Therefore, high count rate sources usually have depressed pulse height values relative to their position on the detector. Low pulse height values are correlated with larger source PSFs, as the photons "spread out" more on the detector. 

The type of MCP detector (Z stack) used by GALEX has an asymmetric pulse height distribution, which makes correcting for it harder. The mission and gPhoton2 use the walk correction to address this effect, but it doesn't work perfectly because we still see an inflation of star FWHMs with low pulse heights. 

```{image} figures/q_mean_example.png
:alt: pulseheightmean
:width: 500px
:align: center
```
*Figure: Mean pulse height decreases radially outwards, corresponding to distance from detector center. High-count sources have lower mean pulse heights.*

We run photometry on a mean pulse height image to get:
1) General location of the source on the detector, using the rule of thumb that lower pulse heights are near the edge.
2) Estimate how much a source spread on the detector as pulse height decreased during an observation, increasing the FWHM of the source.

While we don't measure the maximum pulse height values in gPhoton2, they do affect the mean values. Notably, the maximum pulse height values correspond to the outlines of the walk correction file frames. [WHAT DOES THIS MEAN? figure out the exact implications for the q photometry column] 
```{image} figures/qmax.png
:alt: pulseheightmax
:width: 600px
:align: center
```
*Figure: Maximum pulse heights in a single NUV eclipse compared to the shape of a frame from the NUV walk correction file. Note the polygonal shapes visible in the left image.*


## YA Photometry 

YA Photometry is most useful for post-CSP eclipses which have "ghosts" with low YA values. While we only run ghost-flagging for post-CSP eclipses, we do photometry on mean YA images for all eclipses. As you can see below, in normal eclipses the mean YA value is relatively unremarkable other than a faint striped pattern. Stars are virtually indistinguishable from the background. See {doc}`the page on photon masking <pages/photonmasking>` for more discussion of ghosts. 

```{image} figures/ya_mean_example.png
:alt: yamean
:width: 500px
:align: center
```
*Figure: Mean YA values binned in sky-projected coordinates.*